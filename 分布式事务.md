# 分布式事务

## 什么是分布式事务？

> 分布式事务是指事务的参与者、支持事务的服务器、资源服务器以及事务管理器分别位于不同的[分布式系统](https://baike.baidu.com/item/分布式系统/4905336)的不同节点之上。  -- 百度百科

```java
@Service
public class OrderService {
    
  private void insert() {
    insertOrder();
  }

@Transactional
public void insertOrder() {
   //insert log info
   //insert Order         
   //update Account
  }
}
```

如上图，是常见的spring中实现一个事务的代码。在本次业务处理中，我们在插入order表数据的时候，还要更新log日志表以及account表。如果某一个sql语句失败了，那么这个事务就失败了，其他的已经执行的sql语句需要回滚。这都是针对同一个数据库的场景。但是如果log日志表，订单order表，账户account表是位于不同的数据库呢？那么@Transactional就失效了。

在某次的事务处理中，如果涉及的微服务分布在不同的节点，那么我们就把本次的事务称之为分布式事务。每一个子节点都是一个分支事务，这些分支事务合起来构成了本次的全局事务。

其实对比传统意义的mysql的事务的概念，分布式事务就是在这之上的一层包装。我们引入协调者的角色，协调各个分支事务的提交与回滚，从而保证全局事务的提交或者回滚。

> 分布式事务实际上不是什么高深的概念，只是跟随现在流行的微回收提出来的对跨数据库事务的处理的方法。传统的单机应用中，我们的数据库往往是单一的，只需要mysql自身对事务的支持即可。但是在现在的微回收系统中，不同节点的服务往往都有自己的数据库，甚至不同服务应用的底层数据库都是不同的，这种情况下我们就提出了分布式事务的概念，通过对各个分支事务的协调处理来实现对全局事务提交或者回滚。

